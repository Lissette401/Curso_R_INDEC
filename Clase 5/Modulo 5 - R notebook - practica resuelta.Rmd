---
title: "Módulo 5 - R Markdown"
subtitle: "Ejemplo informe"
author: "Pablo Tiscornia^[Dirección de la Encuesta Permanente de Hogares] y Carla Barreca^[Dirección de Estadísticas de Condiciones de Vida]"
date: "*12 de noviembre de 2019*"
output: 
  html_notebook:
    toc: true
    

---

<br>

Continuar con el informe de la clase.

Crear un tabulado que muestre la tasa de desocupación por sexo y grupo de edad, para los siguientes grupos:

- Mujeres de 14 a 29 años
- Mujeres de 30 a 64 años
- Varones de 14 a 29 años
- Varones de 30 a 64 años

Efectuar un gráfico de barras con la información anterior, que muestre para cada sexo la tasa de desocupación por grupo de edad.
Describir brevemente lo observado.


# Mercado de trabajo. Tasas e indicadores socioeconómicos (EPH)



```{r message=FALSE, warning=FALSE, include=FALSE}
library(openxlsx)
library(tidyverse)
library(knitr)
library(ggalt)
library(kableExtra)
library(formattable)
#library(eph)


```

```{r include=FALSE}
#Levantamos la base de la EPH del primer trimestre de 2019

individual_t119 <-
  read.table("../Fuentes/usu_individual_t119.txt",
  sep = ";",
  dec = ",",
  header = TRUE,
  fill = TRUE )

#base <- get_microdata(year = 2019, trimester = 1, type = "individual")

individual_t119 <- individual_t119 %>% 
  rename(Sexo = CH04) %>% 
  mutate(Sexo = factor(x= Sexo, 
                       levels = c(1,2),
                       labels = c("Varones","Mujeres")),
         Grupo_edad = factor(x= case_when(CH06>=14 & CH06<=29 ~ 1,
                                          CH06>=30 & CH06<=64 ~ 2),
                             levels = c(1,2),
                             labels = c("14 a 29","30 a 64")))

```







<br>

### Tasas específicas por sexo y grupo de edad

```{r include=FALSE}

Tasas_sexo <- individual_t119 %>% 
  filter(CH06>=14 & CH06<=64) %>% 
  group_by(Sexo, Grupo_edad) %>% 
  summarise(Poblacion         = sum(PONDERA),
            Ocupados          = sum(PONDERA[ESTADO == 1]),
            Desocupados       = sum(PONDERA[ESTADO == 2]),
            PEA               = Ocupados + Desocupados,
# También podemos llamar a las variables entre comillas, incluyendo nombres compuestos
# A su vez, podemos utilizar la variable recién creada en la definción de otra varible
            'Tasa Desocupacion'               = round(Desocupados/PEA*100,1))%>%
  select(1,2,7) 
  
  Tasas_sexo_tabla <- Tasas_sexo %>% 
  spread(.,
         key = Sexo,
         value= `Tasa Desocupacion`)


```




```{r echo=TRUE}

Tasas_sexo_tabla %>%
kable(., 
      align = "l",
      caption = "Tasas de desocupación por sexo y grupo de edad - 1er trimestre 2019") %>%
  kable_styling(bootstrap_options ="basic",
                full_width = T) %>%
  footnote(general = "Encuesta Permanente de Hogares - 1T 2019",
           general_title = "Fuente:",
           footnote_as_chunk = T)%>%
  column_spec(1, bold = T) %>%
  column_spec(3, bold = T,color = "pink") %>%
  add_header_above(c(" ", "Sexo" = 2))


```




<br>

#### **Gráficos**


```{r echo=FALSE}
Tasas_sexo %>% 
  ggplot() +
  geom_bar(aes(x = Sexo,
               y = `Tasa Desocupacion`,
               fill = Grupo_edad),
           position = "dodge",
           stat     = "identity")+
  theme_minimal()+
  geom_text(aes(x = Sexo,
               y = `Tasa Desocupacion`,
               group = Grupo_edad,
               label = paste0(round(`Tasa Desocupacion`,1), "%")),
            position=position_dodge(width=0.9),
            vjust = -0.5,
            size = 3) +
  labs(title = "Tasas específicas por sexo del mercado laboral. \n  Total Aglomerados. Trimestre 1, año 2019",
       x = "",
       y = "Porcentaje",
       caption = "Fuente: Encuesta Permanente de Hogares - 1T 2019")
```

<br>

<br>

